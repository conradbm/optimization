sets:
companies/1..7/:X, RET, VAR;
compcomp(companies,companies): COV, COR;
endsets

data:
!- Expected Return;
!- APPL	24.752190
   AXP       45.575439
   BA        64.056630
   GOOGL    246.040619  
   IBM      119.442298
   MSFT      27.649523
   PFE       26.264286;
RET = 24.752190, 45.575439,  64.056630,
      246.040619, 119.442298, 27.649523,
      26.264286;
!- Correlation Matrix;
!- Symbol,AAPL,AXP,BA,GOOGL,IBM,MSFT,PFE
   AAPL,1.0,0.58436560802,0.592523982857,0.83565666732,0.970279244768,0.361502972618,-0.444885746053
   AXP,0.58436560802,1.0,0.885608569559,0.569596400532,0.549179117595,0.618419534224,-0.0465100038226
   BA,0.592523982857,0.885608569559,1.0,0.739653665018,0.553259558804,0.572391677032,-0.273501439518
   GOOGL,0.83565666732,0.569596400532,0.739653665018,1.0,0.8338416718,0.641064585788,-0.177808923876
   IBM,0.970279244768,0.549179117595,0.553259558804,0.8338416718,1.0,0.462904311923,-0.298931273576
   MSFT,0.361502972618,0.618419534224,0.572391677032,0.641064585788,0.462904311923,1.0,0.491661350853
   PFE,-0.444885746053,-0.0465100038226,-0.273501439518,-0.177808923876,-0.298931273576,0.491661350853,1.0;
COR = 1.0,0.58436560802,0.592523982857,0.83565666732,0.970279244768,0.361502972618,-0.444885746053,
      0.58436560802,1.0,0.885608569559,0.569596400532,0.549179117595,0.618419534224,-0.0465100038226,
      0.592523982857,0.885608569559,1.0,0.739653665018,0.553259558804,0.572391677032,-0.273501439518,
      0.83565666732,0.569596400532,0.739653665018,1.0,0.8338416718,0.641064585788,-0.177808923876,
      0.970279244768,0.549179117595,0.553259558804,0.8338416718,1.0,0.462904311923,-0.298931273576,
      0.361502972618,0.618419534224,0.572391677032,0.641064585788,0.462904311923,1.0,0.491661350853,
      -0.444885746053,-0.0465100038226,-0.273501439518,-0.177808923876,-0.298931273576,0.491661350853,1.0;
!- Covariance Matrix;
!- Symbol,AAPL,AXP,BA,GOOGL,IBM,MSFT,PFE
   AAPL,731.130482292,201.081362603,331.379265492,2264.58421545,1088.11926205,25.5125227401,-91.9334531924
   AXP,201.081362603,161.949440379,233.106019388,715.973603385,289.858507808,20.5407838102,-4.52338691661
   BA,331.379265492,233.106019388,427.803077275,1345.15031106,474.605962045,30.9000618602,-43.2323860176
   GOOGL,2264.58421545,715.973603385,1345.15031106,9949.87843765,3660.27597476,173.545089397,-97.1346970845
   IBM,1088.11926205,289.858507808,474.605962045,3660.27597476,1720.14327847,50.1092178761,-94.7504541609
   MSFT,25.5125227401,20.5407838102,30.9000618602,173.545089397,50.1092178761,6.81221228416,9.80703653321
   PFE,-91.9334531924,-4.52338691661,-43.2323860176,-97.1346970845,-94.7504541609,9.80703653321,58.4057053366;
COV = 731.130482292,201.081362603,331.379265492,2264.58421545,1088.11926205,25.5125227401,-91.9334531924
      201.081362603,161.949440379,233.106019388,715.973603385,289.858507808,20.5407838102,-4.52338691661
      331.379265492,233.106019388,427.803077275,1345.15031106,474.605962045,30.9000618602,-43.2323860176
      2264.58421545,715.973603385,1345.15031106,9949.87843765,3660.27597476,173.545089397,-97.1346970845
      1088.11926205,289.858507808,474.605962045,3660.27597476,1720.14327847,50.1092178761,-94.7504541609
      25.5125227401,20.5407838102,30.9000618602,173.545089397,50.1092178761,6.81221228416,9.80703653321
      -91.9334531924,-4.52338691661,-43.2323860176,-97.1346970845,-94.7504541609,9.80703653321,58.4057053366;
! Variances
   APPL 731.130482
   AXP       161.949440
   BA        427.803077
   GOOGL    9949.878438
   IBM      1720.143278
   MSFT        6.812212
   PFE        58.405705 ; 
VAR = 731.130482,
          161.949440,
           427.803077,
       9949.878438,
         1720.143278,
          6.812212,
          58.405705;

lambda = 1;
N = 7;
enddata

max = @sum(companies(j):X(j)*RET(j)) - 
     lambda*1/N*@sum(compcomp(i,j)|j#GE#i:X(j)*COV(i,j)) - 
     (1-lambda)*1/N*@sum(compcomp(i,j)|j#GE#i:X(j)*COR(i,j));

@sum(companies(j): X(j)) = 1;
@for(companies(j): X(j) >=0);
@for(companies(j): X(j) <= .33);