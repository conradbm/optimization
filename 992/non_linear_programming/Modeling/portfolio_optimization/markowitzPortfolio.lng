sets:
years/1..13/:year;
companies/1..7/:X, RET, VAR;
compcomp(companies,companies): COV, COR;
yearcomp(years,companies):dat;
endsets

data:
!-  Data ;
!-  Date,AAPL,AXP,BA,GOOGL,IBM,MSFT,PFE
    2001,1.44175095785,33.8942827586,51.7873471264,,107.333201149,31.2051172414,41.6513344828
    2002,1.36918505747,32.2916793103,39.7475900383,,84.4935965517,27.3277509579,34.8991275862
    2003,1.32202452107,36.3774157088,33.2845210728,,85.0744061303,26.0904827586,31.8935210728
    2004,2.53559503817,45.2859461832,47.686259542,76.0112680412,90.839310687,27.1461412214,32.9853576336
    2005,6.67423384615,48.1635688462,62.2689230769,139.141874615,83.8295769231,25.8785384615,25.5462692308
    2006,10.12643,54.4226961538,79.9302307692,206.063471538,83.1449230769,26.3133115385,25.6652096154
    2007,18.2743429119,59.2228348659,94.446102682,269.419577011,105.699118774,30.4624616858,25.2614176245
    2008,20.3047385496,37.9793816794,66.5175664122,233.05465916,109.942786641,26.6758473282,19.3245083969
    2009,20.9248126437,26.924559387,45.1246360153,219.765361686,109.122183908,22.9754482759,15.7485823755
    2010,37.0740436782,41.6424425287,65.98598659,268.210936398,131.84433908,27.0657662835,16.771816092
    2011,51.9801419231,47.4911153846,69.7691153846,284.758061923,170.877769231,26.0503980769,19.53095
    2012,82.1508597701,55.9744061303,73.2252681992,321.772086207,196.413716475,29.7820636015,23.2020670498
    2013,67.6003091954,72.8103831418,102.962643678,442.208897318,194.134942529,32.4704739464,28.9555528736;
dat = 1.44175095785,33.8942827586,51.7873471264,0,107.333201149,31.2051172414,41.6513344828
      1.36918505747,32.2916793103,39.7475900383,0,84.4935965517,27.3277509579,34.8991275862
      1.32202452107,36.3774157088,33.2845210728,0,85.0744061303,26.0904827586,31.8935210728
      2.53559503817,45.2859461832,47.686259542,76.0112680412,90.839310687,27.1461412214,32.9853576336
      6.67423384615,48.1635688462,62.2689230769,139.141874615,83.8295769231,25.8785384615,25.5462692308
      10.12643,54.4226961538,79.9302307692,206.063471538,83.1449230769,26.3133115385,25.6652096154
      18.2743429119,59.2228348659,94.446102682,269.419577011,105.699118774,30.4624616858,25.2614176245
      20.3047385496,37.9793816794,66.5175664122,233.05465916,109.942786641,26.6758473282,19.3245083969
      20.9248126437,26.924559387,45.1246360153,219.765361686,109.122183908,22.9754482759,15.7485823755
      37.0740436782,41.6424425287,65.98598659,268.210936398,131.84433908,27.0657662835,16.771816092
      51.9801419231,47.4911153846,69.7691153846,284.758061923,170.877769231,26.0503980769,19.53095
      82.1508597701,55.9744061303,73.2252681992,321.772086207,196.413716475,29.7820636015,23.2020670498
      67.6003091954,72.8103831418,102.962643678,442.208897318,194.134942529,32.4704739464,28.9555528736;
!- Expected Return;
!- APPL	24.752190
   AXP       45.575439
   BA        64.056630
   GOOGL    246.040619  
   IBM      119.442298
   MSFT      27.649523
   PFE       26.264286;
RET = 24.752190, 45.575439,  64.056630,
      246.040619, 119.442298, 27.649523,
      26.264286;
!- Correlation Matrix;
!- Symbol,AAPL,AXP,BA,GOOGL,IBM,MSFT,PFE
   AAPL,1.0,0.58436560802,0.592523982857,0.83565666732,0.970279244768,0.361502972618,-0.444885746053
   AXP,0.58436560802,1.0,0.885608569559,0.569596400532,0.549179117595,0.618419534224,-0.0465100038226
   BA,0.592523982857,0.885608569559,1.0,0.739653665018,0.553259558804,0.572391677032,-0.273501439518
   GOOGL,0.83565666732,0.569596400532,0.739653665018,1.0,0.8338416718,0.641064585788,-0.177808923876
   IBM,0.970279244768,0.549179117595,0.553259558804,0.8338416718,1.0,0.462904311923,-0.298931273576
   MSFT,0.361502972618,0.618419534224,0.572391677032,0.641064585788,0.462904311923,1.0,0.491661350853
   PFE,-0.444885746053,-0.0465100038226,-0.273501439518,-0.177808923876,-0.298931273576,0.491661350853,1.0;
COR = 1.0,0.58436560802,0.592523982857,0.83565666732,0.970279244768,0.361502972618,-0.444885746053,
      0.58436560802,1.0,0.885608569559,0.569596400532,0.549179117595,0.618419534224,-0.0465100038226,
      0.592523982857,0.885608569559,1.0,0.739653665018,0.553259558804,0.572391677032,-0.273501439518,
      0.83565666732,0.569596400532,0.739653665018,1.0,0.8338416718,0.641064585788,-0.177808923876,
      0.970279244768,0.549179117595,0.553259558804,0.8338416718,1.0,0.462904311923,-0.298931273576,
      0.361502972618,0.618419534224,0.572391677032,0.641064585788,0.462904311923,1.0,0.491661350853,
      -0.444885746053,-0.0465100038226,-0.273501439518,-0.177808923876,-0.298931273576,0.491661350853,1.0;
!- Covariance Matrix;
!- Symbol,AAPL,AXP,BA,GOOGL,IBM,MSFT,PFE
   AAPL,731.130482292,201.081362603,331.379265492,2264.58421545,1088.11926205,25.5125227401,-91.9334531924
   AXP,201.081362603,161.949440379,233.106019388,715.973603385,289.858507808,20.5407838102,-4.52338691661
   BA,331.379265492,233.106019388,427.803077275,1345.15031106,474.605962045,30.9000618602,-43.2323860176
   GOOGL,2264.58421545,715.973603385,1345.15031106,9949.87843765,3660.27597476,173.545089397,-97.1346970845
   IBM,1088.11926205,289.858507808,474.605962045,3660.27597476,1720.14327847,50.1092178761,-94.7504541609
   MSFT,25.5125227401,20.5407838102,30.9000618602,173.545089397,50.1092178761,6.81221228416,9.80703653321
   PFE,-91.9334531924,-4.52338691661,-43.2323860176,-97.1346970845,-94.7504541609,9.80703653321,58.4057053366;
COV = 731.130482292,201.081362603,331.379265492,2264.58421545,1088.11926205,25.5125227401,-91.9334531924
      201.081362603,161.949440379,233.106019388,715.973603385,289.858507808,20.5407838102,-4.52338691661
      331.379265492,233.106019388,427.803077275,1345.15031106,474.605962045,30.9000618602,-43.2323860176
      2264.58421545,715.973603385,1345.15031106,9949.87843765,3660.27597476,173.545089397,-97.1346970845
      1088.11926205,289.858507808,474.605962045,3660.27597476,1720.14327847,50.1092178761,-94.7504541609
      25.5125227401,20.5407838102,30.9000618602,173.545089397,50.1092178761,6.81221228416,9.80703653321
      -91.9334531924,-4.52338691661,-43.2323860176,-97.1346970845,-94.7504541609,9.80703653321,58.4057053366;
! Variances
   APPL 731.130482
   AXP       161.949440
   BA        427.803077
   GOOGL    9949.878438
   IBM      1720.143278
   MSFT        6.812212
   PFE        58.405705 ; 
VAR = 731.130482,
          161.949440,
           427.803077,
       9949.878438,
         1720.143278,
          6.812212,
          58.405705;

lambda = 1;
N = 7;
enddata
! - Aggregate data 
max = @sum(companies(j):X(j)*RET(j)) - 
     lambda*1/N*@sum(compcomp(i,j)|j#GE#i:X(j)*COV(i,j)) - 
     (1-lambda)*1/N*@sum(compcomp(i,j)|j#GE#i:X(j)*COR(i,j));
;

! - Raw data ;
max = @sum(companies(j): X(j)*1/N*@sum(years(i): dat(i,j))) - 
      lambda*(1/N-1)*@sum(companies(j): (X(j) - 1/N*@sum(years(i): dat(i,j)))^2);
@sum(companies(j): X(j)) = 1;
@for(companies(j): X(j) >=0);
@for(companies(j): X(j) <= .51);